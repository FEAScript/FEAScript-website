<!DOCTYPE html>

<!--   ______ ______           _____           _       _     -->
<!--  |  ____|  ____|   /\    / ____|         (_)     | |    -->
<!--  | |__  | |__     /  \  | (___   ___ ____ _ ____ | |_   -->
<!--  |  __| |  __|   / /\ \  \___ \ / __|  __| |  _ \| __|  -->
<!--  | |    | |____ / ____ \ ____) | (__| |  | | |_) | |    -->
<!--  |_|    |______/_/    \_\_____/ \___|_|  |_|  __/| |    -->
<!--                                            | |   | |    -->
<!--                                            |_|   | |_   -->
<!--       Website: https://feascript.com/             \__|  -->

<html>
  <head>
    <meta charset="utf-8" />
    <title>FEAScriptModel Speed Test</title>
    <!-- Plotly & Math.js needed by plotSolution -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/5.0.0/math.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/plotly.js/2.27.0/plotly.min.js"></script>
    <style>
      #solutionPlot {
        width: 640px;
        height: 480px;
      }
    </style>
  </head>
  <body>
    <p>Running FEAScriptModel speed test...</p>
    <div id="solutionPlot"></div>
    <script type="module">
      // Import FEAScript library
      // import { FEAScriptModel, plotSolution } from "https://core.feascript.com/dist/feascript.esm.js";
      import { FEAScriptModel, plotSolution } from "../../FEAScript-core/src/index.js";

      // Create a new FEAScript model
      const model = new FEAScriptModel();

      // Set solver configuration
      model.setSolverConfig("solidHeatTransferScript");

      // Define mesh configuration
      model.setMeshConfig({
        meshDimension: "2D",
        elementOrder: "linear",
        numElementsX: 77,
        numElementsY: 39,
        maxX: 4,
        maxY: 2,
      });

      // Calculate total number of elements
      const totalElements = model.meshConfig.numElementsX * model.meshConfig.numElementsY;
      console.log(`Total number of elements in mesh: ${totalElements}`);

      // Set boundary conditions
      model.addBoundaryCondition("0", ["constantTemp", 200]);
      model.addBoundaryCondition("1", ["symmetry"]);
      model.addBoundaryCondition("2", ["convection", 1, 20]);
      model.addBoundaryCondition("3", ["constantTemp", 200]);

      // Set solver method (change to test different solvers)
      model.setSolverMethod("lusolve");
      // model.setSolverMethod("jacobi");
      // model.setSolverMethod("frontal");

      // Solve the problem and get the solution
      const { solutionVector, nodesCoordinates } = model.solve();

      // Plot the solution
      plotSolution(
        solutionVector,
        nodesCoordinates,
        "solidHeatTransferScript",
        "2D",
        "contour",
        "solutionPlot",
        "structured"
      );
    </script>
  </body>
</html>
