<!DOCTYPE html>

<!--
  ════════════════════════════════════════════════════════════════
   FEAScript Website
   Lightweight Finite Element Simulation in JavaScript
   Version: 0.2.0 (RC) | https://feascript.com
   CC BY 4.0 License © 2023–2025 FEAScript
  ════════════════════════════════════════════════════════════════
-->

<html lang="en">
  <head>
    <title>FEAScript: Heat Conduction in a 2D Rhomboid Fin Tutorial (Gmsh Mesh)</title>
    <link rel="icon" type="image/x-icon" href="../assets/favicon.ico" />
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta
      name="description"
      content="This example demonstrates solving a steady-state heat transfer problem in a 2D rhomboid domain using a Gmsh-generated mesh."
    />
    <meta
      name="keywords"
      content="finite elements, fem, galerkin, computational mechanics, javascript, gmsh, 2D heat transfer"
    />
    <meta name="viewport" content="width=device-width" />
    <!-- Link to the CSS files -->
    <link href="../feascript-website.css" rel="stylesheet" type="text/css" />
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet" />
    <!-- Import the Math.js library for mathematical operations -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.12.0/math.min.js"></script>
    <!-- Import the Plotly.js library for plotting -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/plotly.js/2.35.3/plotly.min.js"></script>
    <!-- Import MathJax for writing equations -->
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script
      id="MathJax-script"
      async
      src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"
    ></script>
    <!-- Import the run_prettify.js library for JavaScript code coloring *** Deprecated library *** -->
    <script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js"></script>
  </head>

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-1JPK0KLEC9"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() {
      dataLayer.push(arguments);
    }
    gtag("js", new Date());

    gtag("config", "G-1JPK0KLEC9");
  </script>

  <body>
    <h1 class="top">
      <a href="../index.html">
        <img
          src="../assets/feascript-logo-christmas.png"
          alt="FEAScript Logo"
          id="responsive-logo"
          style="vertical-align: middle"
        />
      </a>
      <div class="social-icons-top-right">
        <ul>
          <li>
            <a href="https://blog.feascript.com/" title="FEAScript blog">
              <img
                src="../assets/blog-icon-feascript.png"
                alt="Blog icon"
                style="height: 18px; vertical-align: middle"
              />
            </a>
          </li>
          <li>
            <a href="https://www.youtube.com/@FEAScript" title="FEAScript YouTube">
              <img
                src="../assets/youtube-icon-feascript.svg"
                alt="YouTube icon"
                style="height: 18px; vertical-align: middle"
              />
            </a>
          </li>
          <li>
            <a href="https://www.linkedin.com/company/feascript/" title="FEAScript LinkedIn">
              <img
                src="../assets/linkedin-icon-feascript.png"
                alt="LinkedIn icon"
                style="height: 18px; vertical-align: middle"
              />
            </a>
          </li>
          <li>
            <a href="https://discord.gg/3DVjNcuW4f" title="FEAScript Discord">
              <img
                src="../assets/discord-icon-feascript.png"
                alt="Discord icon"
                style="height: 18px; vertical-align: middle"
              />
            </a>
          </li>
          <li>
            <a href="https://github.com/FEAScript/FEAScript-core" title="FEAScript GitHub">
              <img
                src="../assets/github-icon-feascript.png"
                alt="GitHub icon"
                style="height: 20px; vertical-align: middle"
              />
              <span
                id="github-stars"
                style="
                  font-size: 0.9em;
                  margin-left: 5px;
                  vertical-align: middle;
                  border: 1px solid #ddd;
                  border-radius: 4px;
                  padding: 1px 5px;
                  background-color: #f8f8f8;
                "
              ></span>
            </a>
          </li>
        </ul>
      </div>
    </h1>
    <h1>Heat Conduction in a 2D Rhomboid Fin Tutorial (Gmsh Mesh)</h1>

    <ul id="menu">
      <li><a href="#gmshfileimport">Gmsh File Import</a></li>
      <li>
        <a href="#gmshgeofile">Example Gmsh <code>.geo</code> File</a>
      </li>
      <li><a href="#generatedmesh">Generated Mesh</a></li>
      <li><a href="#results">Results</a></li>
    </ul>

    <div class="highlight-container">
      <p>
        This page demonstrates solving the 2D heat conduction fin problem using a Gmsh-generated mesh. It is a
        variation of the <a href="heat-conduction-2d-fin-gmsh.html">rectangular fin tutorial</a>, but applied
        to a rhomboidal domain.
        <a href="https://gmsh.info/">
          Gmsh
          <img
            src="https://upload.wikimedia.org/wikipedia/commons/4/44/Icon_External_Link.svg"
            alt="External Link Icon"
            style="width: 16px; height: 16px; vertical-align: middle; margin-left: 2px; margin-bottom: 4px"
        /></a>
        is a powerful mesh generation tool that can create complex geometries and meshes for finite element
        analysis. For the mathematical formulation and theory, see the
        <a href="heat-conduction-2d-fin.html">basic tutorial</a>.
      </p>
    </div>

    <h2 id="gmshfileimport"><a name="gmshfileimport"></a>Gmsh File Import</h2>
    <p>
      This example demonstrates how to import a Gmsh-generated mesh (<code>.msh</code> file format) and solve
      a heat conduction problem.
    </p>

    <pre class="prettyprint">
&lt;body&gt;
  &lt;!-- ...body region... --&gt;
  &lt;script type="module"&gt;
    // Import FEAScript library
    import { FEAScriptModel, importGmshQuadTri, plotInterpolatedSolution, printVersion } from "https://core.feascript.com/dist/feascript.esm.js";
  
    window.addEventListener("DOMContentLoaded", async () => {
      // Print FEAScript version in the console
      printVersion();
  
      // Fetch the mesh file
      const response = await fetch("./rhom_quad.msh"); // .msh version 4.1 is currently supported
      if (!response.ok) {
        throw new Error(`Failed to load mesh file: ${response.status} ${response.statusText}`);
      }
      const meshContent = await response.text();
  
      // Create a File object with the actual content
      const meshFile = new File([meshContent], "rhom_quad.msh");
  
      // Create and configure model
      const model = new FEAScriptModel();
      model.setModelConfig("heatConductionScript");
  
      // Parse the mesh file
      const rhom_quad = await importGmshQuadTri(meshFile);
  
      // Define mesh configuration with the parsed rhom_quad
      model.setMeshConfig({
        parsedMesh: rhom_quad,
        meshDimension: "2D",
        elementOrder: "quadratic",
      });
  
      // Apply boundary conditions using Gmsh physical group tags
      model.addBoundaryCondition("0", ["constantTemp", 200]); // bottom boundary
      model.addBoundaryCondition("1", ["constantTemp", 200]); // right boundary
      model.addBoundaryCondition("2", ["convection", 1, 20]); // top boundary
      model.addBoundaryCondition("3", ["symmetry"]); // left boundary
  
      // Solve
      model.setSolverMethod("lusolve");
      const result = model.solve();
  
      // Plot results
      plotInterpolatedSolution(model, result, "contour", "resultsCanvas");
    });
  &lt;/script&gt;
  &lt;!-- ... rest of body region... --&gt;
&lt;/body&gt;</pre
    >

    <p>
      For details on the Gmsh workflow, physical groups, and boundary condition mapping, please refer to the
      <a href="heat-conduction-2d-fin-gmsh.html#gmshfileimport">rectangular fin tutorial</a>.
    </p>

    <h3 id="gmshgeofile"><a name="gmshgeofile"></a>Example Gmsh <code>.geo</code> File</h3>
    <p>
      Below is the <code>rhom.geo</code> file used in this tutorial. It defines a 4 m × 2 m rectangular domain
      with physical lines for each boundary edge:
    </p>

    <pre class="prettyprint">
// 2D Rhomboid: 4m (base width) x 2m (height) with physical lines for boundary labeling

lc = 0.7; // Characteristic length

dx = 1.0; // Horizontal skew amount (controls rhomboid angle)

// Points (x, y, z, mesh size)
Point(1) = {0,    0, 0, lc};     // Bottom left
Point(2) = {4,    0, 0, lc};     // Bottom right
Point(3) = {4+dx, 2, 0, lc};     // Top right (shifted)
Point(4) = {dx,   2, 0, lc};     // Top left  (shifted)

// Lines
Line(1) = {1, 2}; // bottom
Line(2) = {2, 3}; // right
Line(3) = {3, 4}; // top
Line(4) = {4, 1}; // left

// Line Loop and Surface
Line Loop(1) = {1, 2, 3, 4};
Plane Surface(1) = {1};

// Physical Lines
Physical Line("bottom") = {1};
Physical Line("right")  = {2};
Physical Line("top")    = {3};
Physical Line("left")   = {4};

// Physical Surface
Physical Surface("domain") = {1};

// Recombine to quads
Recombine Surface{1};
Mesh.ElementOrder = 2;
Mesh 2;</pre
    >

    <p>
      To generate a mesh file from this <code>.geo</code> script, you would run:
      <code>gmsh rhom.geo -2</code> in your terminal.
    </p>

    <h2 id="generatedmesh"><a name="generatedmesh"></a>Generated Mesh</h2>
    <p>
      Below is a visualization of the quadrilateral mesh generated with Gmsh. The mesh consists of 24
      elements.
    </p>

    <div class="center-image">
      <img
        src="../assets/gmsh_rhom_quad.png"
        alt="Quadrilateral mesh generated by Gmsh"
        style="max-width: 40%; height: auto"
      />
      <p class="image-caption">
        Quadrilateral mesh (<code>rhom_quad.msh</code>) generated using the
        <code>rhom.geo</code> script with Gmsh
      </p>
    </div>

    <h2 id="results"><a name="results"></a>Results</h2>
    <p>
      Below is the 2D contour plot of the computed temperature distribution. This plot is generated in real
      time using FEAScript.
    </p>

    <div id="resultsCanvas"></div>

    <ul id="menu">
      <li><a href="https://feascript.com/index.html">Home</a></li>
      <li><a href="https://feascript.com/#tutorials">All Tutorials</a></li>
    </ul>

    <script type="module">
      // Import FEAScript library from GitHub
      import {
        FEAScriptModel,
        importGmshQuadTri,
        plotInterpolatedSolution,
        printVersion,
      } from "https://core.feascript.com/dist/feascript.esm.js";
      // Import FEAScript library from a local directory
      // import {
      //   FEAScriptModel,
      //   importGmshQuadTri,
      //   plotInterpolatedSolution,
      //   printVersion,
      //   logSystem,
      // } from "../../FEAScript-core/src/index.js";

      window.addEventListener("DOMContentLoaded", async () => {
        // Enable debug logging mode
        //logSystem("debug");

        // Print FEAScript version in the console
        console.log("FEAScript version:", printVersion);

        // Fetch the mesh file
        const response = await fetch("./rhom_quad.msh"); // .msh version 4.1 is currently supported
        if (!response.ok) {
          throw new Error(`Failed to load mesh file: ${response.status} ${response.statusText}`);
        }
        const meshContent = await response.text();

        // Create a File object with the actual content
        const meshFile = new File([meshContent], "rhom_quad.msh");

        // Create a new FEAScript model
        const gmshModel = new FEAScriptModel();

        // Set solver configuration
        gmshModel.setModelConfig("heatConductionScript");

        // Parse the mesh file
        const rhom_quad = await importGmshQuadTri(meshFile);

        // Define mesh configuration with the parsed rhom_quad
        gmshModel.setMeshConfig({
          parsedMesh: rhom_quad,
          meshDimension: "2D",
          elementOrder: "quadratic",
        });

        // Define boundary conditions using Gmsh physical group tags
        gmshModel.addBoundaryCondition("0", ["constantTemp", 200]); // Bottom boundary
        gmshModel.addBoundaryCondition("1", ["constantTemp", 200]); // Right boundary
        gmshModel.addBoundaryCondition("2", ["convection", 1, 20]); // Top boundary
        gmshModel.addBoundaryCondition("3", ["symmetry"]); // Left boundary

        // Set solver method
        //model.setSolverMethod("jacobi");
        gmshModel.setSolverMethod("lusolve");

        // Solve the problem and get the solution
        const result = gmshModel.solve();

        // Plot the Gmsh solution
        plotInterpolatedSolution(gmshModel, result, "contour", "resultsCanvas");
      });
    </script>

    <footer>
      <p>&#169; 2023-<span id="currentYear"></span> FEAScript</p>
    </footer>
    <script>
      document.getElementById("currentYear").innerHTML = new Date().getFullYear();

      // Fetch GitHub stars
      fetch("https://api.github.com/repos/FEAScript/FEAScript-core")
        .then((response) => response.json())
        .then((data) => {
          const starCount = data.stargazers_count;
          const starsElement = document.getElementById("github-stars");
          if (starsElement && starCount) {
            starsElement.innerHTML = `★ ${starCount}`;
          }
        })
        .catch((error) => console.error("Error fetching GitHub stars:", error));
    </script>
  </body>
</html>
