<!DOCTYPE html>

<!--   ______ ______           _____           _       _     -->
<!--  |  ____|  ____|   /\    / ____|         (_)     | |    -->
<!--  | |__  | |__     /  \  | (___   ___ ____ _ ____ | |_   -->
<!--  |  __| |  __|   / /\ \  \___ \ / __|  __| |  _ \| __|  -->
<!--  | |    | |____ / ____ \ ____) | (__| |  | | |_) | |    -->
<!--  |_|    |______/_/    \_\_____/ \___|_|  |_|  __/| |    -->
<!--                                            | |   | |    -->
<!--                                            |_|   | |_   -->
<!--       Website: https://feascript.com/             \__|  -->

<html lang="en">
  <head>
    <title>FEAScript: Heat Conduction in a Two-Dimensional Fin Tutorial (Gmsh Example)</title>
    <link rel="icon" type="image/x-icon" href="../assets/favicon.ico" />
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta
      name="description"
      content="This example demonstrates solving a steady-state heat transfer problem in a 2D rectangular domain using a Gmsh-generated mesh."
    />
    <meta
      name="keywords"
      content="finite elements, fem, galerkin, cfd, computational mechanics, javascript, gmsh"
    />
    <meta name="viewport" content="width=device-width" />
    <!-- Link to the CSS files -->
    <link href="../FEAScript-website.css" rel="stylesheet" type="text/css" />
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet" />
    <!-- Import the Math.js library for mathematical operations -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/5.0.0/math.min.js"></script>
    <!-- Import the Plotly.js library for plotting -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/plotly.js/2.27.0/plotly.min.js"></script>
    <!-- Import MathJax for writing equations -->
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script
      id="MathJax-script"
      async
      src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"
    ></script>
    <style>
      #resultOutput {
        height: 500px;
        margin-top: 10px;
        padding: 10px;
        background: #f0f0f0;
        overflow: auto;
        border: 1px solid #ccc;
        white-space: pre-wrap;
        font-family: monospace;
      }
      #orientation-message {
        display: none;
        color: red;
        font-weight: bold;
      }
    </style>
  </head>

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-1JPK0KLEC9"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() {
      dataLayer.push(arguments);
    }
    gtag("js", new Date());

    gtag("config", "G-1JPK0KLEC9");
  </script>

  <body>
    <h1 class="top">
      <a href="../index.html">
        <img
          src="../assets/FEAScriptLogo.png"
          alt="FEAScript Logo"
          id="responsive-logo"
          style="vertical-align: middle"
        />
      </a>
    </h1>
    <h1>Heat Conduction in a Two-Dimensional Fin (Gmsh Example)</h1>

    <ul id="menu">
      <li><a href="#gmshfileimport">Gmsh File Import</a></li>
      <li><a href="#results">Results</a></li>
    </ul>

    <div class="highlight-container">
      <p>
        This page demonstrates solving the 2D heat conduction fin problem using a Gmsh-generated mesh.
        <a href="https://gmsh.info/" target="_blank">Gmsh</a> is a powerful mesh generation tool that can
        create complex geometries and meshes for finite element analysis. For the mathematical formulation and
        theory, see the <a href="HeatConduction2DFin.html" target="_blank">main (standard) tutorial</a>.
      </p>
    </div>

    <h2 id="gmshfileimport"><a name="gmshfileimport"></a>Gmsh File Import</h2>
    <p>The code below shows how to import a Gmsh (.msh) file and set up the problem.</p>

    <h2 id="results"><a name="results"></a>Results</h2>

    <div id="solutionPlot"></div>

    <ul id="menu">
      <li>
        <a href="https://feascript.com/tutorials/HeatConduction2DFin.html" target="_blank"
          >Return to Main Tutorial</a
        >
      </li>
      <li>
        <a href="https://feascript.com/index.html" target="_blank">Return to FEAScript Website</a>
      </li>
    </ul>

    <script type="module">
      // Import FEAScript library from GitHub
      //import { FEAScriptModel, importGmshQuadTri, plotSolution, printVersion } from "https://core.feascript.com/src/index.js";
      // Import FEAScript library from a local directory
      import {
        FEAScriptModel,
        importGmshQuadTri,
        plotSolution,
        printVersion,
      } from "../../FEAScript-core/src/index.js";

      window.addEventListener("DOMContentLoaded", async () => {
        // Print FEAScript version in the console
        printVersion();

        console.log("-------- GMSH MESH APPROACH --------");
        // Fetch the mesh file from your server
        const response = await fetch("./rect_quad.msh");
        if (!response.ok) {
          throw new Error(`Failed to load mesh file: ${response.status} ${response.statusText}`);
        }
        const meshContent = await response.text();

        // Create a File object with the actual content
        const meshFile = new File([meshContent], "rect_quad.msh");

        // Create a new FEAScript model
        const gmshModel = new FEAScriptModel();

        // Set solver configuration
        gmshModel.setSolverConfig("solidHeatTransferScript");

        // Parse the mesh file first
        const result = await importGmshQuadTri(meshFile);

        console.log("GMSH Boundary Conditions:", result.boundaryConditions);
        console.log("GMSH Boundary Elements:", result.boundaryElements);
        console.log("GMSH Nodal Numbering:", result.nodalNumbering);
        console.log("x Coordinates:", result.nodesXCoordinates);
        console.log("y Coordinates:", result.nodesYCoordinates);

        // Define mesh configuration with the parsed result
        gmshModel.setMeshConfig({
          parsedMesh: result,
          meshDimension: "2D",
          elementOrder: "linear",
        });

        // Define boundary conditions using Gmsh physical group tags
        gmshModel.addBoundaryCondition("0", ["constantTemp", 200]); // bottom boundary
        gmshModel.addBoundaryCondition("1", ["constantTemp", 200]); // right boundary
        gmshModel.addBoundaryCondition("2", ["constantTemp", 100]); // top boundary
        gmshModel.addBoundaryCondition("3", ["symmetry"]); // left boundary

        console.log("GMSH Boundary Conditions:", gmshModel.boundaryConditions);

        // Set solver method
        //model.setSolverMethod("jacobi");
        gmshModel.setSolverMethod("lusolve");

        // Solve the problem and get the solution
        const { solutionVector: gmshSolutionVector, nodesCoordinates: gmshNodesCoordinates } = gmshModel.solve();

        console.log("GMSH Solution Vector:", gmshSolutionVector);

        // Plot the GMSH solution
        plotSolution(
          gmshSolutionVector,
          gmshNodesCoordinates,
          gmshModel.solverConfig,
          gmshModel.meshConfig.meshDimension,
          "contour",
          "solutionPlot",
          "unstructured"
        );

        console.log("-------- GEOMETRY MESH APPROACH --------");
        // Create a new FEAScript model for the geometry-based mesh
        const geoModel = new FEAScriptModel();

        // Set solver configuration
        geoModel.setSolverConfig("solidHeatTransferScript");

        // Define mesh configuration using geometry
        geoModel.setMeshConfig({
            meshDimension: "2D",
            elementOrder: "quadratic",
            numElementsX: 8,
            numElementsY: 4,
            maxX: 4,
            maxY: 2,
          });

        // Define boundary conditions - equivalent to the GMSH setup
        geoModel.addBoundaryCondition("0", ["constantTemp", 200]); // bottom boundary
        geoModel.addBoundaryCondition("1", ["symmetry"]); // left boundary
        geoModel.addBoundaryCondition("2", ["convection", 1, 20]); // top boundary
        geoModel.addBoundaryCondition("3", ["constantTemp", 200]); // right boundary

        console.log("GEO Boundary Conditions:", geoModel.boundaryConditions);

        // Set solver method
        //model.setSolverMethod("jacobi");
        geoModel.setSolverMethod("lusolve");

        // Solve the problem and get the solution
        const { solutionVector: geoSolutionVector, nodesCoordinates: geoNodesCoordinates } = geoModel.solve();

      });
    </script>

    <p>&#169; 2023-<span id="currentYear"></span> FEAScript</p>
  </body>
</html>
