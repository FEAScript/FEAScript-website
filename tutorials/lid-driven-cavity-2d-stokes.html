<!DOCTYPE html>

<!--
  ════════════════════════════════════════════════════════════════
   FEAScript Website
   Lightweight Finite Element Simulation in JavaScript
   Version: 0.2.0 (RC) | https://feascript.com
   CC BY 4.0 License © 2023–2026 FEAScript
  ════════════════════════════════════════════════════════════════
-->

<html>
  <head>
    <title>FEAScript: Stokes Flow in a 2D Lid-Driven Cavity Tutorial</title>
    <link rel="icon" type="image/x-icon" href="../assets/favicon.ico" />
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta
      name="description"
      content="This tutorial demonstrates solving the steady Stokes equations in a 2D lid-driven cavity using FEAScript. It uses Taylor-Hood (Q2-Q1) mixed finite elements for velocity-pressure coupling."
    />
    <meta
      name="keywords"
      content="finite elements, fem, galerkin, computational mechanics, javascript, stokes flow, lid-driven cavity, Taylor-Hood, mixed finite elements, FEAScript"
    />
    <meta name="viewport" content="width=device-width" />
    <!-- Link to the CSS files -->
    <link href="../feascript-website.css" rel="stylesheet" type="text/css" />
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet" />
    <!-- Import the Math.js library for mathematical operations -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.12.0/math.min.js"></script>
    <!-- Import the Plotly.js library for plotting -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/plotly.js/2.35.3/plotly.min.js"></script>
    <!-- Import MathJax for writing equations -->
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script
      id="MathJax-script"
      async
      src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"
    ></script>
    <!-- Import the run_prettify.js library for JavaScript code coloring *** Deprecated library *** -->
    <script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js"></script>
  </head>

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-1JPK0KLEC9"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() {
      dataLayer.push(arguments);
    }
    gtag("js", new Date());

    gtag("config", "G-1JPK0KLEC9");
  </script>

  <body>
    <h1 class="top">
      <a href="../index.html">
        <img
          src="../assets/feascript-logo.png"
          alt="FEAScript Logo"
          id="responsive-logo"
          style="vertical-align: middle"
        />
      </a>
      <div class="social-icons-top-right">
        <ul>
          <li>
            <a href="https://blog.feascript.com/" title="FEAScript blog">
              <img
                src="../assets/blog-icon-feascript.png"
                alt="Blog icon"
                style="height: 18px; vertical-align: middle"
              />
            </a>
          </li>
          <li>
            <a href="https://www.youtube.com/@FEAScript" title="FEAScript YouTube">
              <img
                src="../assets/youtube-icon-feascript.svg"
                alt="YouTube icon"
                style="height: 18px; vertical-align: middle"
              />
            </a>
          </li>
          <li>
            <a href="https://www.linkedin.com/company/feascript/" title="FEAScript LinkedIn">
              <img
                src="../assets/linkedin-icon-feascript.png"
                alt="LinkedIn icon"
                style="height: 18px; vertical-align: middle"
              />
            </a>
          </li>
          <li>
            <a href="https://discord.gg/3DVjNcuW4f" title="FEAScript Discord">
              <img
                src="../assets/discord-icon-feascript.png"
                alt="Discord icon"
                style="height: 18px; vertical-align: middle"
              />
            </a>
          </li>
          <li>
            <a href="https://github.com/FEAScript/FEAScript-core" title="FEAScript GitHub">
              <img
                src="../assets/github-icon-feascript.png"
                alt="GitHub icon"
                style="height: 20px; vertical-align: middle"
              />
              <span
                id="github-stars"
                style="
                  font-size: 0.9em;
                  margin-left: 5px;
                  vertical-align: middle;
                  border: 1px solid #ddd;
                  border-radius: 4px;
                  padding: 1px 5px;
                  background-color: #f8f8f8;
                "
              ></span>
            </a>
          </li>
        </ul>
      </div>
    </h1>
    <h1>Stokes Flow in a 2D Lid-Driven Cavity Tutorial</h1>

    <ul id="menu">
      <li><a href="#mathematicalformulation">Mathematical Formulation</a></li>
      <li><a href="#solvingwithfeascript">Solving with FEAScript</a></li>
      <li><a href="#results">Results</a></li>
    </ul>

    <div class="highlight-container">
      <p>
        In this tutorial, we solve the steady Stokes flow equations inside a two-dimensional lid-driven
        cavity. The lid-driven cavity is a classical benchmark problem in computational fluid dynamics
        where the top wall moves at a constant horizontal velocity while the remaining walls are
        stationary, driving a recirculating flow inside the domain.
      </p>
    </div>

    <h2 id="mathematicalformulation"><a name="Mathematical formulation"></a>Mathematical Formulation</h2>
    <p>
      The steady Stokes equations for an incompressible Newtonian fluid with no body forces are: \(\nabla
      \cdot \mathbf{u} = 0\) and \(-\mu \nabla^{2} \mathbf{u} + \nabla p = \mathbf{0}\), where
      \(\mathbf{u} = (u,v)\) is the velocity vector, \(p\) is the pressure, and \(\mu\) is the dynamic
      viscosity. In the FEAScript implementation below, we set the viscosity coefficient to \(\mu = 1.0\).
    </p>

    <div class="center-image">
      <img src="../assets/stokes-2d-lid-driven.png" alt="2D Stokes flow schematic" width="300" />
      <p class="image-caption">
        Schematic of the 2D lid-driven cavity: horizontal velocity (u=1) at the top edge, and no-slip
        condition (u=v=0) at the other edges.
      </p>
    </div>

    <p>
      The above schematic illustrates the problem domain and outlines the associated boundary conditions. To
      satisfy the Ladyzhenskaya&ndash;Babu&scaron;ka&ndash;Brezzi (LBB) inf-sup stability condition,
      FEAScript uses the Taylor-Hood mixed finite element formulation. In this approach, velocity is
      discretized with 9-node biquadratic (Q2) elements and pressure with 4-node bilinear (Q1) elements.
    </p>

    <h2 id="solvingwithfeascript"><a name="Solving with FEAScript"></a>Solving with FEAScript</h2>
    <p>
      Below is a demonstration of how to use the FEAScript library to solve the Stokes lid-driven cavity
      problem in your web browser. You only need a simple HTML page to run this example where the following
      code snippets should be included. First, load the required external libraries:
    </p>
    <pre class="prettyprint">
&lt;head&gt;
  &lt;!-- ...head region... --&gt;
  &lt;script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.12.0/math.min.js"&gt;&lt;/script&gt;
  &lt;script src="https://cdnjs.cloudflare.com/ajax/libs/plotly.js/2.35.3/plotly.min.js"&gt;&lt;/script&gt;
  &lt;!-- ...rest of head region... --&gt;
&lt;/head&gt;</pre
    >
    <p>
      We should then define the problem parameters, such as the model type, the mesh configuration, and
      the boundary conditions. This is performed using JavaScript objects directly in the HTML file:
    </p>
    <pre class="prettyprint">
&lt;body&gt;
  &lt;!-- ...body region... --&gt;
  &lt;script type="module"&gt;
    // Import FEAScript library
    import { FEAScriptModel, plotSolution, printVersion } from "https://core.feascript.com/dist/feascript.esm.js";

    window.addEventListener("DOMContentLoaded", (event) => {
      // Print FEAScript version in the console
      printVersion();

      // Create and configure model
      const model = new FEAScriptModel();
      model.setModelConfig("stokesScript");
      model.setMeshConfig({
        meshDimension: "2D",
        elementOrder: "quadratic",
        numElementsX: 12,
        numElementsY: 6,
        maxX: 4,
        maxY: 2,
      });

      // Apply boundary conditions
      model.addBoundaryCondition("0", ["constantVelocity", 0, 0]); // Bottom boundary
      model.addBoundaryCondition("1", ["constantVelocity", 0, 0]); // Left boundary
      model.addBoundaryCondition("2", ["constantVelocity", 1, 0]); // Top boundary
      model.addBoundaryCondition("3", ["constantVelocity", 0, 0]); // Right boundary

      // Solve
      model.setSolverMethod("lusolve");
      const result = model.solve();

      // Extract velocity and pressure fields from the solution vector
      const totalNodesVelocity = model._stokesMetadata.totalNodesVelocity;
      const solutionVector = result.solutionVector;
      const uVelocity = solutionVector.slice(0, totalNodesVelocity);
      const vVelocity = solutionVector.slice(totalNodesVelocity, 2 * totalNodesVelocity);
      const velocityMagnitude = uVelocity.map((u, i) => Math.sqrt(u * u + vVelocity[i] * vVelocity[i]));

      // Plot velocity magnitude as a contour
      plotSolution(model, { solutionVector: velocityMagnitude, nodesCoordinates: result.nodesCoordinates },
        "contour", "velocityMagnitudeCanvas");

      // Plot u-velocity component as a contour
      plotSolution(model, { solutionVector: uVelocity, nodesCoordinates: result.nodesCoordinates },
        "contour", "uVelocityCanvas");

      // Plot v-velocity component as a contour
      plotSolution(model, { solutionVector: vVelocity, nodesCoordinates: result.nodesCoordinates },
        "contour", "vVelocityCanvas");
    });
  &lt;/script&gt;
  &lt;!-- ...rest of body region... --&gt;
&lt;/body&gt;</pre
    >
    <p>
      In the boundary condition definition, the numbers at the left side (from <code>"0"</code> to
      <code>"3"</code>) indicate the boundaries of the geometry (the mesh generator of FEAScript has
      assigned numbers to the boundaries, starting from the bottom boundary and proceeding clockwise).
      The <code>"constantVelocity"</code> condition sets the velocity components \(u\) and \(v\) at the
      boundary nodes (the second and third arguments respectively).
    </p>
    <p>
      Since the Stokes solver uses a mixed formulation, the solution vector contains all DOFs packed
      sequentially: \([u_0, \ldots, u_{N_2-1}, \, v_0, \ldots, v_{N_2-1}, \, p_0, \ldots, p_{N_1-1}]\),
      where \(N_2\) is the number of velocity nodes (Q2) and \(N_1\) is the number of pressure nodes
      (Q1). The velocity components are extracted by slicing the solution vector, and each field can then
      be plotted individually using the existing <code>plotSolution</code> function.
    </p>
    <p>
      After solving the case, the results are shown in 2D contour plots. To visualize them, include HTML
      containers where the plots will render:
    </p>
    <pre class="prettyprint">
&lt;body&gt;
  &lt;!-- ...body region... --&gt;
  &lt;div id="velocityMagnitudeCanvas"&gt;&lt;/div&gt;
  &lt;div id="uVelocityCanvas"&gt;&lt;/div&gt;
  &lt;div id="vVelocityCanvas"&gt;&lt;/div&gt;
  &lt;!-- ...rest of body region... --&gt;
&lt;/body&gt;</pre
    >

    <h2 id="results"><a name="Results"></a>Results</h2>
    <p>
      Below are the 2D contour plots of the computed velocity magnitude \(|\mathbf{u}| = \sqrt{u^2+v^2}\),
      horizontal velocity component \(u\), and vertical velocity component \(v\). These plots are
      generated in real time using FEAScript.
    </p>

    <h3>Velocity Magnitude</h3>
    <div id="velocityMagnitudeCanvas"></div>

    <h3>Horizontal Velocity (\(u\))</h3>
    <div id="uVelocityCanvas"></div>

    <h3>Vertical Velocity (\(v\))</h3>
    <div id="vVelocityCanvas"></div>

    <br />

    <ul id="menu">
      <li><a href="https://feascript.com/index.html">Home</a></li>
      <li><a href="https://feascript.com/#tutorials">All Tutorials</a></li>
    </ul>

    <script type="module">
      // Import FEAScript library from GitHub
      // import {
      //   FEAScriptModel,
      //   plotSolution,
      //   printVersion,
      // } from "https://core.feascript.com/dist/feascript.esm.js";
      // Import FEAScript library from a local directory
      import { FEAScriptModel, plotSolution, printVersion } from "../../FEAScript-core/src/index.js";

      window.addEventListener("DOMContentLoaded", () => {
        // Print FEAScript version
        console.log("FEAScript version:", printVersion);

        // Create a new FEAScript model
        const model = new FEAScriptModel();

        // Set model configuration
        model.setModelConfig("stokesScript");

        // Define mesh configuration
        model.setMeshConfig({
          meshDimension: "2D",
          elementOrder: "quadratic",
          numElementsX: 12,
          numElementsY: 6,
          maxX: 4,
          maxY: 2,
        });

        // Define boundary conditions
        model.addBoundaryCondition("0", ["constantVelocity", 0, 0]); // Bottom wall (no-slip)
        model.addBoundaryCondition("1", ["constantVelocity", 0, 0]); // Left wall (no-slip)
        model.addBoundaryCondition("2", ["constantVelocity", 1, 0]); // Top lid (moving)
        model.addBoundaryCondition("3", ["constantVelocity", 0, 0]); // Right wall (no-slip)

        // Set solver method
        model.setSolverMethod("lusolve");

        // Solve the problem and get the solution
        const result = model.solve();

        // Extract velocity and pressure fields from the solution vector
        // DOF layout: [u₀…u_{N₂−1}, v₀…v_{N₂−1}, p₀…p_{N₁−1}]
        const totalNodesVelocity = model._stokesMetadata.totalNodesVelocity;
        const solutionVector = result.solutionVector;
        const uVelocity = solutionVector.slice(0, totalNodesVelocity);
        const vVelocity = solutionVector.slice(totalNodesVelocity, 2 * totalNodesVelocity);
        const velocityMagnitude = uVelocity.map((u, i) => Math.sqrt(u * u + vVelocity[i] * vVelocity[i]));

        // Plot velocity magnitude as a 2D contour plot
        plotSolution(
          model,
          { solutionVector: velocityMagnitude, nodesCoordinates: result.nodesCoordinates },
          "contour",
          "velocityMagnitudeCanvas"
        );

        // Plot u-velocity component as a 2D contour plot
        plotSolution(
          model,
          { solutionVector: uVelocity, nodesCoordinates: result.nodesCoordinates },
          "contour",
          "uVelocityCanvas"
        );

        // Plot v-velocity component as a 2D contour plot
        plotSolution(
          model,
          { solutionVector: vVelocity, nodesCoordinates: result.nodesCoordinates },
          "contour",
          "vVelocityCanvas"
        );
      });
    </script>

    <footer>
      <p>&#169; 2023-<span id="currentYear"></span> FEAScript</p>
    </footer>
    <script>
      document.getElementById("currentYear").innerHTML = new Date().getFullYear();

      // Fetch GitHub stars
      fetch("https://api.github.com/repos/FEAScript/FEAScript-core")
        .then((response) => response.json())
        .then((data) => {
          const starCount = data.stargazers_count;
          const starsElement = document.getElementById("github-stars");
          if (starsElement && starCount) {
            starsElement.innerHTML = `★ ${starCount}`;
          }
        })
        .catch((error) => console.error("Error fetching GitHub stars:", error));
    </script>
  </body>
</html>
